<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C2W & VC Charging CPFR — Shared Forecast Dashboard</title>
    <style>
        /* ============================================================
           RESET & BASE
           ============================================================ */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #0a1628 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        /* ============================================================
           HEADER
           ============================================================ */
        .header {
            background: #00A9E0;
            padding: 40px 60px;
            box-shadow: 0 10px 40px rgba(0, 169, 224, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: 10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.06) 0%, transparent 70%);
            animation: pulse 5s ease-in-out infinite reverse;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .header-inner {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 44px;
            font-weight: 800;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            letter-spacing: -0.5px;
        }

        .header-left .subtitle {
            font-size: 17px;
            opacity: 0.95;
            margin-top: 6px;
        }

        .header-right {
            text-align: right;
        }

        .header .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .header .badge-live {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.15);
            padding: 6px 16px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .badge-live .dot {
            width: 8px;
            height: 8px;
            background: #00DB84;
            border-radius: 50%;
            animation: dot-blink 2s ease-in-out infinite;
        }

        @keyframes dot-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* ============================================================
           DASHBOARD CONTAINER
           ============================================================ */
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
            padding: 40px 60px;
        }

        /* ============================================================
           SECTION CARD (universal)
           ============================================================ */
        .card {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 35px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #00A9E0;
        }

        /* ============================================================
           LAST UPDATED PANEL
           ============================================================ */
        .update-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }

        .update-card {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            border-radius: 16px;
            padding: 28px 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .update-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }

        .update-card.anker::before {
            background: linear-gradient(90deg, #00A9E0 0%, #40C7FB 100%);
        }

        .update-card.customer::before {
            background: linear-gradient(90deg, #ed8936 0%, #fbbf24 100%);
        }

        .update-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 14px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-dot.green {
            background: #00DB84;
            box-shadow: 0 0 10px rgba(0, 219, 132, 0.5);
        }

        .status-dot.yellow {
            background: #fbbf24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .status-dot.red {
            background: #f56565;
            box-shadow: 0 0 10px rgba(245, 101, 101, 0.5);
            animation: red-pulse 2s infinite;
        }

        @keyframes red-pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(245, 101, 101, 0.5); }
            50% { box-shadow: 0 0 20px rgba(245, 101, 101, 0.8); }
        }

        .update-source {
            font-size: 18px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .update-time {
            font-size: 14px;
            color: #a0aec0;
            margin-bottom: 10px;
        }

        .update-time strong {
            color: #e2e8f0;
        }

        .update-note {
            font-size: 13px;
            line-height: 1.5;
            color: #a0aec0;
            background: rgba(0, 169, 224, 0.08);
            padding: 10px 14px;
            border-radius: 8px;
            border-left: 3px solid rgba(0, 169, 224, 0.4);
        }

        /* ============================================================
           KPI CARDS
           ============================================================ */
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 35px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #00A9E0 0%, #40C7FB 100%);
        }

        .kpi-value {
            font-size: 38px;
            font-weight: 800;
            color: #00A9E0;
            margin-bottom: 6px;
        }

        .kpi-label {
            font-size: 14px;
            color: #a0aec0;
            font-weight: 500;
        }

        .kpi-sub {
            font-size: 12px;
            color: #718096;
            margin-top: 4px;
        }

        /* ============================================================
           CATEGORY BREAKDOWN MINI-CARDS (inside KPI area)
           ============================================================ */
        .cat-breakdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 35px;
        }

        .cat-mini {
            background: rgba(0, 169, 224, 0.06);
            border-radius: 12px;
            padding: 18px 20px;
            border: 1px solid rgba(0, 169, 224, 0.15);
        }

        .cat-mini-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .cat-mini-val {
            font-size: 22px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .cat-mini-sub {
            font-size: 11px;
            color: #718096;
            margin-top: 3px;
        }

        .cat-essential .cat-mini-name { color: #00DB84; }
        .cat-wireless .cat-mini-name { color: #00A9E0; }
        .cat-battery .cat-mini-name { color: #ed8936; }
        .cat-charger .cat-mini-name { color: #f56565; }

        /* ============================================================
           FILTER BAR
           ============================================================ */
        .filter-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            max-width: 350px;
            padding: 10px 18px;
            border-radius: 10px;
            border: 1px solid rgba(0, 169, 224, 0.3);
            background: rgba(26, 32, 44, 0.8);
            color: #e2e8f0;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .filter-input::placeholder { color: rgba(226, 232, 240, 0.4); }
        .filter-input:focus {
            border-color: #00A9E0;
            box-shadow: 0 0 0 3px rgba(0, 169, 224, 0.15);
        }

        .filter-btn {
            padding: 10px 18px;
            border-radius: 10px;
            border: 1px solid rgba(0, 169, 224, 0.3);
            background: rgba(0, 169, 224, 0.1);
            color: #e2e8f0;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(0, 169, 224, 0.25);
            border-color: #00A9E0;
        }

        .filter-btn.active {
            color: #00A9E0;
        }

        /* ============================================================
           CPFR TABLE
           ============================================================ */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .table-wrapper::-webkit-scrollbar {
            height: 8px;
        }
        .table-wrapper::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }
        .table-wrapper::-webkit-scrollbar-thumb {
            background: rgba(0, 169, 224, 0.4);
            border-radius: 4px;
        }
        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 169, 224, 0.6);
        }

        .cpfr-table {
            width: max-content;
            min-width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 13px;
        }

        .cpfr-table thead th {
            background: rgba(0, 169, 224, 0.2);
            padding: 12px 14px;
            text-align: right;
            font-weight: 700;
            font-size: 12px;
            border-bottom: 2px solid #00A9E0;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 2;
            color: #e2e8f0;
        }

        .cpfr-table thead th:first-child,
        .cpfr-table thead th:nth-child(2),
        .cpfr-table thead th:nth-child(3) {
            text-align: left;
        }

        /* Sticky left columns */
        .cpfr-table .sticky-col {
            position: sticky;
            z-index: 3;
            background: inherit;
        }

        .cpfr-table thead .sticky-col {
            z-index: 5;
        }

        .cpfr-table .col-sku { left: 0; min-width: 140px; }
        .cpfr-table .col-cust { left: 140px; min-width: 100px; }
        .cpfr-table .col-price { left: 240px; min-width: 70px; }

        .cpfr-table tbody td {
            padding: 9px 14px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            text-align: right;
            white-space: nowrap;
            color: #cbd5e0;
        }

        .cpfr-table tbody td:first-child {
            text-align: left;
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 12px;
            color: #a0aec0;
        }

        .cpfr-table tbody td:nth-child(2),
        .cpfr-table tbody td:nth-child(3) {
            text-align: left;
        }

        .cpfr-table tbody tr:hover td {
            background: rgba(0, 169, 224, 0.08);
        }

        .cpfr-table tbody tr:nth-child(even) td {
            background: rgba(255,255,255,0.02);
        }

        .cpfr-table tbody tr:nth-child(even):hover td {
            background: rgba(0, 169, 224, 0.08);
        }

        /* Category header row */
        .cpfr-table .cat-row td {
            background: rgba(0, 169, 224, 0.12) !important;
            font-weight: 700;
            font-size: 14px;
            color: #00A9E0;
            border-bottom: 2px solid rgba(0, 169, 224, 0.3);
            padding: 14px;
            letter-spacing: 0.5px;
        }

        /* Totals row */
        .cpfr-table .totals-row td {
            background: rgba(0, 169, 224, 0.15) !important;
            font-weight: 800;
            color: #ffffff;
            border-top: 2px solid #00A9E0;
            font-size: 13px;
        }

        /* Weekly column subtle borders */
        .cpfr-table .week-cell {
            border-left: 1px solid rgba(255,255,255,0.04);
            min-width: 65px;
        }

        /* Editable indicator */
        .cpfr-table .editable {
            border: 1px solid rgba(0, 169, 224, 0.2);
            border-radius: 4px;
            padding: 7px 10px;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
        }

        .cpfr-table .editable:hover {
            border-color: rgba(0, 169, 224, 0.5);
            background: rgba(0, 169, 224, 0.05);
        }

        /* Color for OH / WOS */
        .wos-good { color: #00DB84; }
        .wos-warn { color: #fbbf24; }
        .wos-danger { color: #f56565; }

        /* Quarter subtotal cols */
        .cpfr-table .qt-col {
            border-right: 1px solid rgba(255,255,255,0.08);
        }

        .cpfr-table .section-divider {
            border-left: 2px solid rgba(0, 169, 224, 0.25);
        }

        /* Customer badge */
        .cust-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }
        .cust-c2 { background: rgba(0, 219, 132, 0.15); color: #00DB84; }
        .cust-vc { background: rgba(237, 137, 54, 0.15); color: #ed8936; }

        /* ============================================================
           CHART AREA (mini sparkline-style)
           ============================================================ */
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 35px;
        }

        .chart-canvas-wrap {
            position: relative;
            height: 280px;
        }

        /* ============================================================
           FOOTER
           ============================================================ */
        .footer {
            text-align: center;
            padding: 30px 60px;
            color: #4a5568;
            font-size: 13px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .footer .brand {
            color: #00A9E0;
            font-weight: 700;
        }

        .footer .conf {
            margin-top: 6px;
            font-size: 11px;
            color: #2d3748;
        }

        /* ============================================================
           RESPONSIVE
           ============================================================ */
        @media (max-width: 1200px) {
            .kpi-row, .cat-breakdown { grid-template-columns: repeat(2, 1fr); }
            .update-panel { grid-template-columns: 1fr; }
            .chart-grid { grid-template-columns: 1fr; }
            .dashboard { padding: 25px 20px; }
            .header { padding: 25px 20px; }
            .header-left h1 { font-size: 30px; }
        }

        /* ============================================================
           SCROLL HINT
           ============================================================ */
        .scroll-hint {
            text-align: right;
            font-size: 12px;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .scroll-hint span {
            color: #00A9E0;
        }
    </style>
</head>
<body>

    <!-- ============================================================
         HEADER
         ============================================================ -->
    <div class="header">
        <div class="header-inner">
            <div class="header-left">
                <h1>C2W &amp; VC Charging CPFR</h1>
                <div class="subtitle">Collaborative Planning, Forecasting &amp; Replenishment — 2026 WK03</div>
            </div>
            <div class="header-right">
                <div class="badge">Shared Forecast Dashboard</div>
                <div class="badge-live"><span class="dot"></span> Dual-Source Sync Active</div>
            </div>
        </div>
    </div>

    <!-- ============================================================
         DASHBOARD
         ============================================================ -->
    <div class="dashboard">

        <!-- LAST UPDATED PANEL -->
        <div class="update-panel">
            <div class="update-card anker">
                <div class="update-card-header">
                    <div class="status-dot green" id="dotAnker"></div>
                    <div class="update-source">Anker (Kyle Bartlett)</div>
                </div>
                <div class="update-time">Last updated: <strong id="tsAnker">Feb 19, 2026 10:30 AM CST</strong></div>
                <div class="update-note">Updated W+5 through W+12 quantities for Essential SKUs; adjusted Q2 sell-through estimates based on latest POS data.</div>
            </div>
            <div class="update-card customer">
                <div class="update-card-header">
                    <div class="status-dot yellow" id="dotC2"></div>
                    <div class="update-source">C2 Wireless</div>
                </div>
                <div class="update-time">Last updated: <strong id="tsC2">Feb 17, 2026 2:15 PM CST</strong></div>
                <div class="update-note">Revised on-hand counts for Battery and Charger categories; updated W+0 through W+4 sell-in actuals for VoiceComm.</div>
            </div>
        </div>

        <!-- KPI CARDS -->
        <div class="kpi-row" id="kpiRow">
            <!-- filled by JS -->
        </div>

        <!-- CATEGORY BREAKDOWN -->
        <div class="cat-breakdown" id="catBreakdown">
            <!-- filled by JS -->
        </div>

        <!-- CHARTS -->
        <div class="chart-grid">
            <div class="card" style="padding:25px;">
                <div class="card-title">Weekly Forecast by Category</div>
                <div class="chart-canvas-wrap">
                    <canvas id="chartWeekly"></canvas>
                </div>
            </div>
            <div class="card" style="padding:25px;">
                <div class="card-title">Quarterly Sell-Through Distribution</div>
                <div class="chart-canvas-wrap">
                    <canvas id="chartQuarterly"></canvas>
                </div>
            </div>
        </div>

        <!-- MAIN CPFR TABLE -->
        <div class="card">
            <div class="card-title">CPFR Forecast Detail</div>
            <div class="filter-bar">
                <input type="text" class="filter-input" id="filterInput" placeholder="Search SKU, customer, category…">
                <button class="filter-btn active" data-cat="all" onclick="filterCat(this)">All</button>
                <button class="filter-btn" data-cat="Essential" onclick="filterCat(this)">Essential</button>
                <button class="filter-btn" data-cat="Wireless" onclick="filterCat(this)">Wireless</button>
                <button class="filter-btn" data-cat="Battery" onclick="filterCat(this)">Battery</button>
                <button class="filter-btn" data-cat="Charger" onclick="filterCat(this)">Charger</button>
            </div>
            <div class="scroll-hint">Scroll right for weekly columns →  <span>W+0 … W+29</span></div>
            <div class="table-wrapper">
                <table class="cpfr-table" id="cpfrTable">
                    <thead id="cpfrHead"></thead>
                    <tbody id="cpfrBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <div>Powered by <span class="brand">Bartlett Labs</span></div>
        <div class="conf">CONFIDENTIAL — This dashboard contains proprietary forecast data shared under NDA between Anker Innovations and C2 Wireless / VoiceComm. Do not distribute.</div>
    </div>

    <!-- ============================================================
         CHART.JS (CDN)
         ============================================================ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- ============================================================
         DATA & LOGIC
         ============================================================ -->
    <script>
    // ================================================================
    // HARDCODED SAMPLE DATA — will be replaced by Google Sheets API
    // ================================================================

    const WEEKS = 30; // W+0 … W+29
    const WEEK_LABELS = Array.from({length: WEEKS}, (_, i) => `W+${i}`);

    // Helper: distribute totalOFC across weeks with some realistic variance
    function distributeWeeks(total, weeks, opts = {}) {
        const {frontLoad = false, backLoad = false, flat = false, spike = null} = opts;
        const arr = [];
        let remaining = total;
        for (let i = 0; i < weeks; i++) {
            let base;
            if (flat) {
                base = Math.round(total / weeks);
            } else if (frontLoad) {
                base = Math.round((total / weeks) * (1.3 - (0.6 * i / weeks)));
            } else if (backLoad) {
                base = Math.round((total / weeks) * (0.7 + (0.6 * i / weeks)));
            } else {
                base = Math.round(total / weeks);
            }
            // add noise ±15%
            const noise = 1 + (Math.random() - 0.5) * 0.3;
            let val = Math.max(0, Math.round(base * noise));
            if (spike !== null && i === spike) val = Math.round(val * 2.5);
            if (i === weeks - 1) {
                val = Math.max(0, remaining);
            } else {
                val = Math.min(val, remaining);
            }
            remaining -= val;
            arr.push(val);
        }
        return arr;
    }

    // Seed the PRNG for reproducible data
    let _seed = 42;
    function seededRandom() {
        _seed = (_seed * 16807) % 2147483647;
        return (_seed - 1) / 2147483646;
    }
    function sRandInt(min, max) { return Math.floor(seededRandom() * (max - min + 1)) + min; }

    function distributeWeeksSeeded(total, weeks, opts = {}) {
        const arr = [];
        let remaining = total;
        for (let i = 0; i < weeks; i++) {
            let base = Math.round(total / weeks);
            if (opts.frontLoad) base = Math.round((total / weeks) * (1.4 - (0.8 * i / weeks)));
            else if (opts.backLoad) base = Math.round((total / weeks) * (0.6 + (0.8 * i / weeks)));
            const noise = 1 + (seededRandom() - 0.5) * 0.25;
            let val = Math.max(0, Math.round(base * noise));
            if (i === weeks - 1) val = Math.max(0, remaining);
            else val = Math.min(val, remaining);
            remaining -= val;
            arr.push(val);
        }
        return arr;
    }

    function distributeQuarters(total) {
        const q1 = Math.round(total * (0.2 + seededRandom() * 0.1));
        const q2 = Math.round(total * (0.22 + seededRandom() * 0.1));
        const q3 = Math.round(total * (0.2 + seededRandom() * 0.1));
        const q4 = total - q1 - q2 - q3;
        return [q1, q2, q3, Math.max(0, q4)];
    }

    const RAW_SKUS = [
        // Essential
        { sku: 'A1367H11-1', cat: 'Essential', desc: 'PowerPort III Nano 20W', price: 8.99, ofc: 7361, cust: 'C2 Wireless', oh: 1450, selloutAvg: 280 },
        { sku: 'A8189Q21-1', cat: 'Essential', desc: 'PowerLine III Flow USB-C', price: 14.99, ofc: 2366, cust: 'C2 Wireless', oh: 520, selloutAvg: 95 },
        { sku: 'A1F5FH21-1', cat: 'Essential', desc: 'Nano Pro 20W Charger', price: 15.99, ofc: 3500, cust: 'VoiceComm', oh: 680, selloutAvg: 130 },
        { sku: 'A81FEH21-1', cat: 'Essential', desc: 'PowerLine Select+ USB-C', price: 9.99, ofc: 7052, cust: 'C2 Wireless', oh: 1820, selloutAvg: 310 },
        { sku: 'A1F7FH21-1', cat: 'Essential', desc: 'PowerPort Atom III Slim', price: 19.99, ofc: 1512, cust: 'VoiceComm', oh: 240, selloutAvg: 55 },
        { sku: 'A81H5H11-1', cat: 'Essential', desc: 'PowerLine III USB-A to C', price: 7.99, ofc: 1488, cust: 'C2 Wireless', oh: 380, selloutAvg: 72 },

        // Wireless
        { sku: 'A81H7H11-1', cat: 'Wireless', desc: 'MagGo Qi2 Pad', price: 27.99, ofc: 900, cust: 'C2 Wireless', oh: 150, selloutAvg: 35 },
        { sku: 'A2326J21-1', cat: 'Wireless', desc: 'MagGo 3-in-1 Stand', price: 32.99, ofc: 1848, cust: 'VoiceComm', oh: 310, selloutAvg: 68 },
        { sku: 'A2738HJ4J-2', cat: 'Wireless', desc: 'Wireless Charging Station', price: 46.79, ofc: 1000, cust: 'C2 Wireless', oh: 180, selloutAvg: 40 },
        { sku: 'B3MA21H1-1', cat: 'Wireless', desc: 'MagSafe Car Mount Charger', price: 29.99, ofc: 1008, cust: 'VoiceComm', oh: 200, selloutAvg: 42 },

        // Battery
        { sku: 'A1336011', cat: 'Battery', desc: 'PowerCore Select 10K', price: 16.99, ofc: 200, cust: 'VoiceComm', oh: 85, selloutAvg: 12 },
        { sku: 'A1618H11-1', cat: 'Battery', desc: 'PowerCore III Elite 25600', price: 45.99, ofc: 4320, cust: 'C2 Wireless', oh: 760, selloutAvg: 165 },
        { sku: 'A1654H11-1', cat: 'Battery', desc: 'PowerCore Slim 10000 PD', price: 25.99, ofc: 1728, cust: 'C2 Wireless', oh: 350, selloutAvg: 70 },
        { sku: 'A1653H11-1', cat: 'Battery', desc: 'PowerCore 26800 PD', price: 39.99, ofc: 9750, cust: 'VoiceComm', oh: 2100, selloutAvg: 380 },

        // Charger
        { sku: 'A2698JZ1-1', cat: 'Charger', desc: 'Anker 30W USB-C Charger', price: 1.25, ofc: 80136, cust: 'C2 Wireless', oh: 18500, selloutAvg: 3200 },
    ];

    // Flesh out data with quarterly + weekly distributions
    const SKU_DATA = RAW_SKUS.map(s => {
        const [q1, q2, q3, q4] = distributeQuarters(s.ofc);
        const weeks = distributeWeeksSeeded(s.ofc, WEEKS, {frontLoad: s.cat === 'Charger'});
        const wos = s.oh > 0 && s.selloutAvg > 0 ? +(s.oh / s.selloutAvg).toFixed(1) : 0;
        return {...s, q1, q2, q3, q4, weeks, wos, pdt: s.cat};
    });

    const CATEGORIES = ['Essential', 'Wireless', 'Battery', 'Charger'];
    const CAT_COLORS = {Essential: '#00DB84', Wireless: '#00A9E0', Battery: '#ed8936', Charger: '#f56565'};

    // ================================================================
    // KPI CALCULATION
    // ================================================================
    const totalSKUs = SKU_DATA.length;
    const totalOFC = SKU_DATA.reduce((s, r) => s + r.ofc, 0);
    const totalOH = SKU_DATA.reduce((s, r) => s + r.oh, 0);
    const avgWOS = +(SKU_DATA.reduce((s, r) => s + r.wos, 0) / SKU_DATA.length).toFixed(1);

    // ================================================================
    // RENDER KPIs
    // ================================================================
    document.getElementById('kpiRow').innerHTML = [
        {val: totalSKUs, label: 'Active SKUs', sub: '4 categories'},
        {val: totalOFC.toLocaleString(), label: 'Total Forecast Units', sub: 'All weeks combined'},
        {val: totalOH.toLocaleString(), label: 'Current On-Hand', sub: 'Across all SKUs'},
        {val: avgWOS + ' wks', label: 'Avg Weeks of Supply', sub: 'OH ÷ Sellout Avg'},
    ].map(k => `
        <div class="kpi-card">
            <div class="kpi-value">${k.val}</div>
            <div class="kpi-label">${k.label}</div>
            <div class="kpi-sub">${k.sub}</div>
        </div>
    `).join('');

    // Category breakdown
    document.getElementById('catBreakdown').innerHTML = CATEGORIES.map(cat => {
        const items = SKU_DATA.filter(s => s.cat === cat);
        const units = items.reduce((s, r) => s + r.ofc, 0);
        const skus = items.length;
        const cls = 'cat-' + cat.toLowerCase();
        return `
            <div class="cat-mini ${cls}">
                <div class="cat-mini-name">${cat}</div>
                <div class="cat-mini-val">${units.toLocaleString()}</div>
                <div class="cat-mini-sub">${skus} SKU${skus > 1 ? 's' : ''} · ${((units / totalOFC) * 100).toFixed(1)}% of total</div>
            </div>
        `;
    }).join('');

    // ================================================================
    // RENDER TABLE
    // ================================================================
    let activeFilter = 'all';
    let searchTerm = '';

    function renderTable() {
        // Header
        let head = '<tr>';
        head += '<th class="sticky-col col-sku">Anker SKU</th>';
        head += '<th class="sticky-col col-cust">Customer</th>';
        head += '<th class="sticky-col col-price">Price</th>';
        head += '<th class="qt-col">Q1</th><th class="qt-col">Q2</th><th class="qt-col">Q3</th><th class="qt-col">Q4</th>';
        head += '<th>OH</th><th>WOS</th>';
        head += '<th class="section-divider">Total OFC</th>';
        for (let i = 0; i < WEEKS; i++) {
            head += `<th class="week-cell">${WEEK_LABELS[i]}</th>`;
        }
        head += '</tr>';
        document.getElementById('cpfrHead').innerHTML = head;

        // Body
        let body = '';
        let grandTotals = {q1:0, q2:0, q3:0, q4:0, oh:0, ofc:0, weeks: new Array(WEEKS).fill(0)};

        CATEGORIES.forEach(cat => {
            const items = SKU_DATA.filter(s => {
                if (activeFilter !== 'all' && s.cat !== activeFilter) return false;
                if (activeFilter !== 'all' && s.cat !== cat) return false;
                if (searchTerm) {
                    const t = searchTerm.toLowerCase();
                    return s.sku.toLowerCase().includes(t) || s.cust.toLowerCase().includes(t) || s.desc.toLowerCase().includes(t) || s.cat.toLowerCase().includes(t);
                }
                return s.cat === cat;
            });

            if (items.length === 0) return;

            // Category header
            const catTotal = items.reduce((s, r) => s + r.ofc, 0);
            body += `<tr class="cat-row"><td colspan="${10 + WEEKS}" style="text-align:left;">▸ ${cat} <span style="font-size:12px; opacity:0.7; margin-left:10px;">${items.length} SKUs · ${catTotal.toLocaleString()} units</span></td></tr>`;

            items.forEach(s => {
                const custClass = s.cust === 'C2 Wireless' ? 'cust-c2' : 'cust-vc';
                const custLabel = s.cust === 'C2 Wireless' ? 'C2W' : 'VC';
                const wosClass = s.wos >= 6 ? 'wos-good' : s.wos >= 3 ? 'wos-warn' : 'wos-danger';

                let row = '<tr>';
                row += `<td class="sticky-col col-sku" style="background:inherit;" title="${s.desc}">${s.sku}</td>`;
                row += `<td class="sticky-col col-cust" style="background:inherit;"><span class="cust-badge ${custClass}">${custLabel}</span></td>`;
                row += `<td class="sticky-col col-price" style="background:inherit;">$${s.price.toFixed(2)}</td>`;
                row += `<td class="qt-col">${s.q1.toLocaleString()}</td>`;
                row += `<td class="qt-col">${s.q2.toLocaleString()}</td>`;
                row += `<td class="qt-col">${s.q3.toLocaleString()}</td>`;
                row += `<td class="qt-col">${s.q4.toLocaleString()}</td>`;
                row += `<td>${s.oh.toLocaleString()}</td>`;
                row += `<td class="${wosClass}">${s.wos}</td>`;
                row += `<td class="section-divider" style="font-weight:700; color:#e2e8f0;">${s.ofc.toLocaleString()}</td>`;
                for (let i = 0; i < WEEKS; i++) {
                    row += `<td class="week-cell editable">${s.weeks[i].toLocaleString()}</td>`;
                }
                row += '</tr>';
                body += row;

                // accumulate totals
                grandTotals.q1 += s.q1;
                grandTotals.q2 += s.q2;
                grandTotals.q3 += s.q3;
                grandTotals.q4 += s.q4;
                grandTotals.oh += s.oh;
                grandTotals.ofc += s.ofc;
                s.weeks.forEach((v, i) => grandTotals.weeks[i] += v);
            });
        });

        // Grand totals row
        body += '<tr class="totals-row">';
        body += '<td class="sticky-col col-sku" style="background:rgba(0,169,224,0.15)!important;">TOTAL</td>';
        body += '<td class="sticky-col col-cust" style="background:rgba(0,169,224,0.15)!important;"></td>';
        body += '<td class="sticky-col col-price" style="background:rgba(0,169,224,0.15)!important;"></td>';
        body += `<td class="qt-col">${grandTotals.q1.toLocaleString()}</td>`;
        body += `<td class="qt-col">${grandTotals.q2.toLocaleString()}</td>`;
        body += `<td class="qt-col">${grandTotals.q3.toLocaleString()}</td>`;
        body += `<td class="qt-col">${grandTotals.q4.toLocaleString()}</td>`;
        body += `<td>${grandTotals.oh.toLocaleString()}</td>`;
        body += '<td></td>';
        body += `<td class="section-divider">${grandTotals.ofc.toLocaleString()}</td>`;
        for (let i = 0; i < WEEKS; i++) {
            body += `<td class="week-cell">${grandTotals.weeks[i].toLocaleString()}</td>`;
        }
        body += '</tr>';

        document.getElementById('cpfrBody').innerHTML = body;
    }

    function filterCat(btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeFilter = btn.getAttribute('data-cat');
        renderTable();
    }

    document.getElementById('filterInput').addEventListener('input', function() {
        searchTerm = this.value;
        renderTable();
    });

    renderTable();

    // ================================================================
    // CHARTS
    // ================================================================
    // Weekly forecast by category (stacked area)
    const weeklyCtx = document.getElementById('chartWeekly').getContext('2d');
    const weeklyDatasets = CATEGORIES.map(cat => {
        const items = SKU_DATA.filter(s => s.cat === cat);
        const weekTotals = Array.from({length: WEEKS}, (_, w) => items.reduce((s, r) => s + r.weeks[w], 0));
        return {
            label: cat,
            data: weekTotals,
            borderColor: CAT_COLORS[cat],
            backgroundColor: CAT_COLORS[cat] + '30',
            fill: true,
            tension: 0.35,
            borderWidth: 2,
            pointRadius: 0,
            pointHoverRadius: 4,
        };
    });

    new Chart(weeklyCtx, {
        type: 'line',
        data: { labels: WEEK_LABELS, datasets: weeklyDatasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { labels: { color: '#a0aec0', font: { size: 12 } } },
                tooltip: {
                    backgroundColor: 'rgba(26,32,44,0.95)',
                    borderColor: '#00A9E0',
                    borderWidth: 1,
                    titleColor: '#e2e8f0',
                    bodyColor: '#cbd5e0',
                    callbacks: {
                        label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString()} units`
                    }
                }
            },
            scales: {
                x: { ticks: { color: '#4a5568', maxRotation: 45 }, grid: { color: 'rgba(255,255,255,0.04)' } },
                y: {
                    stacked: true,
                    ticks: { color: '#4a5568', callback: v => v >= 1000 ? (v/1000)+'K' : v },
                    grid: { color: 'rgba(255,255,255,0.06)' }
                }
            }
        }
    });

    // Quarterly sell-through (grouped bar)
    const quarterCtx = document.getElementById('chartQuarterly').getContext('2d');
    const quarterDatasets = CATEGORIES.map(cat => {
        const items = SKU_DATA.filter(s => s.cat === cat);
        return {
            label: cat,
            data: [
                items.reduce((s, r) => s + r.q1, 0),
                items.reduce((s, r) => s + r.q2, 0),
                items.reduce((s, r) => s + r.q3, 0),
                items.reduce((s, r) => s + r.q4, 0),
            ],
            backgroundColor: CAT_COLORS[cat] + 'CC',
            borderColor: CAT_COLORS[cat],
            borderWidth: 1,
            borderRadius: 4,
        };
    });

    new Chart(quarterCtx, {
        type: 'bar',
        data: { labels: ['Q1', 'Q2', 'Q3', 'Q4'], datasets: quarterDatasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#a0aec0', font: { size: 12 } } },
                tooltip: {
                    backgroundColor: 'rgba(26,32,44,0.95)',
                    borderColor: '#00A9E0',
                    borderWidth: 1,
                    titleColor: '#e2e8f0',
                    bodyColor: '#cbd5e0',
                    callbacks: {
                        label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString()} units`
                    }
                }
            },
            scales: {
                x: { ticks: { color: '#4a5568' }, grid: { color: 'rgba(255,255,255,0.04)' } },
                y: {
                    ticks: { color: '#4a5568', callback: v => v >= 1000 ? (v/1000)+'K' : v },
                    grid: { color: 'rgba(255,255,255,0.06)' }
                }
            }
        }
    });

    // ================================================================
    // STATUS DOT LOGIC
    // ================================================================
    function updateStatusDots() {
        const now = new Date('2026-02-19T16:30:00-06:00'); // simulated "now"
        const ankerDate = new Date('2026-02-19T10:30:00-06:00');
        const c2Date = new Date('2026-02-17T14:15:00-06:00');

        const diffAnker = (now - ankerDate) / (1000 * 60 * 60);
        const diffC2 = (now - c2Date) / (1000 * 60 * 60);

        const dotAnker = document.getElementById('dotAnker');
        const dotC2 = document.getElementById('dotC2');

        dotAnker.className = 'status-dot ' + (diffAnker < 24 ? 'green' : diffAnker < 72 ? 'yellow' : 'red');
        dotC2.className = 'status-dot ' + (diffC2 < 24 ? 'green' : diffC2 < 72 ? 'yellow' : 'red');
    }
    updateStatusDots();

    </script>
</body>
</html>
